@model AmpRageRepo.Models.Path


@{
    ViewData["Title"] = "DisplayPath";
}

<div class="row">
    <div class="col-md-12">
        <!--Ugly solution for javascript to get utf-8 encoded strings-->
        <p hidden id="origin">"@Model.Origin"</p>
        <p hidden id="dest">"@Model.Destination"</p>

        <ul hidden id="wps">
            @foreach (var item in Model.WayPointStrings)
            {
                <li>
                    @Html.Raw(item)
                </li>
            }
        </ul>

        <div id="dvMap" style="min-height:500px"></div>
    </div>
</div>


@section scripts{

    <!--ENSURE YOU CHANGE TO YOUR OWN API KEY HERE !!! -->
    <script src="https://maps.googleapis.com/maps/api/js?libraries=places&key=AIzaSyBhIgKBChJZ9HwlAS5FdKkMFKuneDc8RjY"
            type="text/javascript"
            charset="utf-8">
    </script>

    <!-- code for example 1 -->
    <script charset="utf-8">

        var source, destination;
        var locations = [];
        var directionsDisplay;
        var directionsService = new google.maps.DirectionsService();

        // initialise the location of the map on Chichester in England (ref lat and lng)
        var map = new google.maps.Map(document.getElementById('dvMap'), {
            center: { lat: 62, lng: 17 },
            zoom: 7,
            mapTypeId: 'roadmap'
        });



        google.maps.event.addDomListener(window, 'load', function () {
            directionsDisplay = new google.maps.DirectionsRenderer({ 'draggable': true });
            GetRoute();
        });

        //directionsDisplay.setPanel(document.getElementById('demo'));

        function GetRoute() {

            directionsDisplay.setMap(map);

            var ul = document.getElementById("wps");
            var items = ul.getElementsByTagName("li");

            var wayPoints = [];

            @*@foreach (var item in Model.WayPointStrings)
            {
                @:wayPoints.push({ location: "@item", stopover: true });
            }*@

            for (var i = 0; i < items.length; ++i) {
                var string = items[i].textContent;
                console.log(string);
                wayPoints.push({ location: string, stopover: true });
            }

            var request = {
                origin: document.getElementById('origin').textContent,
                destination: document.getElementById('dest').textContent,
                waypoints: wayPoints, //an array of waypoints
                optimizeWaypoints: true, //set to true if you want google to determine the shortest route or false to use the order specified.
                travelMode: google.maps.DirectionsTravelMode.DRIVING
            };

            directionsService.route(request, function (response, status) {
                console.log(status);
                if (status == google.maps.DirectionsStatus.OK) {

                    response.routes[0].legs.forEach(function (item, index) {
                    });

                    directionsDisplay.setDirections(response);
                }
                else {
                    //handle error
                }
            })
        };

    </script>
    <!-- end code for example 1 -->
}
