@model AmpRageRepo.Models.Path


@{
    ViewData["Title"] = "DisplayPath";
}


<div class="container2">
    <div id="floating-panel">
        <div class="dropdown dropright">
            <button class="btn btn-primary dropdown-toggle" data-toggle="dropdown" href="#"><span>Visa rutt</span></button>
            <div class="dropdown-menu" style="width: 500px;">
                <div id="directions_panel" class="">
                </div>
            </div>
        </div>
    </div>
    <div class="grid-item2">
        <!--Ugly solution for javascript to get utf-8 encoded strings-->
        <p hidden id="origin">"@Model.Origin"</p>
        <p hidden id="dest">"@Model.Destination"</p>

        <ul id="wps">
            @foreach (var item in Model.Waypoints)
            {
                var x = item.CoordString;
                <li>
                    @Html.Raw(x);
                </li>
            }
        </ul>

        <div id="dvMap" style="min-height:650px"></div>
    </div>
</div>


@*<div id="wrapper2">
        <div id="first2">
            <button data-toggle="collapse" data-target="#directions_panel">More info</button>

            <div id="directions_panel" style="width:500px;" class="collapse"></div>

        </div>
        <div id="second2">
            <button data-toggle="collapse" data-target="#demo">Specific info</button>

            <div id="demo" style="width:500px;" class="collapse"></div>

        </div>
    </div>*@

@section scripts{

    <!--ENSURE YOU CHANGE TO YOUR OWN API KEY HERE !!! -->
    <script src="https://maps.googleapis.com/maps/api/js?libraries=places&key=AIzaSyBhIgKBChJZ9HwlAS5FdKkMFKuneDc8RjY"
            type="text/javascript"
            charset="utf-8">
    </script>

    <!-- code for example 1 -->
    <script charset="utf-8">

        var source, destination;
        var locations = [];
        var directionsDisplay;
        var directionsService = new google.maps.DirectionsService();

        // initialise the location of the map on Chichester in England (ref lat and lng)
        var map = new google.maps.Map(document.getElementById('dvMap'), {
            center: { lat: 62, lng: 17 },
            zoom: 7,
            mapTypeId: 'roadmap'
        });



        google.maps.event.addDomListener(window, 'load', function () {
            directionsDisplay = new google.maps.DirectionsRenderer({ 'draggable': true });
            GetRoute();
        });



        function GetRoute() {

            directionsDisplay.setMap(map);

            var ul = document.getElementById("wps");
            var items = ul.getElementsByTagName("li");

            var wayPoints = [];

            for (var i = 0; i < items.length; ++i) {
                var string = items[i].textContent;
                console.log(string);
                wayPoints.push({ location: string, stopover: true });
            }

            var request = {
                origin: document.getElementById('origin').textContent,
                destination: document.getElementById('dest').textContent,
                waypoints: wayPoints, //an array of waypoints
                optimizeWaypoints: true, //set to true if you want google to determine the shortest route or false to use the order specified.
                travelMode: google.maps.DirectionsTravelMode.DRIVING
            };

            directionsService.route(request, function (response, status) {
                if (status == google.maps.DirectionsStatus.OK) {
                    directionsDisplay.setDirections(response);
                    var route = response.routes[0];
                    var summaryPanel = document.getElementById("directions_panel");
                    summaryPanel.innerHTML = "";
                    // For each route, display summary information.
                    for (var i = 0; i < route.legs.length; i++) {
                        var routeSegment = i + 1;
                        summaryPanel.innerHTML += "<b>Ruttdel: " + routeSegment + "</b><br />";
                        summaryPanel.innerHTML += route.legs[i].start_address + " till ";
                        summaryPanel.innerHTML += route.legs[i].end_address + "<br />";
                        summaryPanel.innerHTML += route.legs[i].duration.text + "<br/>";
                        summaryPanel.innerHTML += route.legs[i].distance.text + "<br /><br />";

                    }
                    computeTotalDistance(response);
                } else {
                    alert("directions response " + status);
                }
                //directionsDisplay.setPanel(document.getElementById('demo'));
            });
        }
        function computeTotalDistance(result) {
            var totalDist = 0;
            var totalTime = 0;
            var totalMin = 0;
            var totalHour = 0;

            var myroute = result.routes[0];
            for (i = 0; i < myroute.legs.length; i++) {
                totalDist += myroute.legs[i].distance.value;
                totalTime += myroute.legs[i].duration.value;
            }
            totalDist = totalDist / 1000.

            var totalHour    = Math.floor(totalTime / (60*60));
                    totalTime -= totalHour   * (60*60);
            var totalMin  = Math.floor(totalTime / (60));
                    totalTime -= totalMin * (60);

            document.getElementById("directions_panel").innerHTML += "Totala sträckan är: " + totalDist.toFixed(0) + " km<br>Totala tiden: " + totalHour + " tim " + totalMin + " min ";
           document.getElementById("directions_panel").innerHTML += '<br /> <button type="button" class="btn btn-primary" style="padding-left: 30px; padding-right: 30px"  asp-controller="Path" asp-action="CreatePath">Ny Sökning</button>'
        }

    </script>
    <!-- end code for example 1 -->
}
